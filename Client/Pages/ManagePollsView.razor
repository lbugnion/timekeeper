@using Timekeeper.DataModel
@inject ILogger<ManagePollsView> Log

@if (Parent.UiVisibility == ManagePolls.VisibilityVisible)
{
    <button @onclick="Parent.ToggleFocus"
            title="Toggle focus mode"
            class="focus">
        <i class="fas fa-expand"></i>
    </button>
}
else
{
    <button @onclick="Parent.ToggleFocus"
            title="Toggle focus mode"
            class="focus">
        <i class="fas fa-compress"></i>
    </button>
}

<h1 class="@Parent.UiVisibility @Branding.ForegroundClass">@Branding.PollsPageTitle</h1>

@if (Handler.CurrentSession != null
  && Handler.IsAuthorized != null
  && Handler.IsAuthorized.Value
  && !Handler.IsBusy)
{
    <h2 class="@Parent.UiVisibility @Branding.ForegroundClass">@SessionName</h2>

    @if (Role != Constants.RolePresenter
        && Handler.CurrentSession.Polls.Count == 0)
    {
        <p>No polls found...</p>

        <blockquote>Click below to create a new poll!</blockquote>
    }

    @if (Role == Constants.RolePresenter
        && !Handler.CurrentSession.Polls.Any(p => p.IsPublished))
    {
        <blockquote class="no-clocks-no-session">
            Polls will appear here when the Host publishes them. Stay tuned!!
        </blockquote>
    }

    @foreach (var poll in Handler.CurrentSession.Polls)
    {
        @if (Role != Constants.RolePresenter
            || poll.IsPublished)
        {
            <ManagePoll CurrentPoll="@poll"
                        Role="@Role"
                        Parent="@this" />
        }
    }

    @if (CurrentPoll != null)
    {
        <ManagePoll CurrentPoll="@CurrentPoll"
                    Role="@Role"
                    Parent="@this" />
    }

    @if(!IsAnyPollEdited
        && Role?.ToLower() != "presenter")
    {
        <button @onclick="CreateNewPoll"
                class="poll-create-save">Create new poll</button>
    }
}
else
{
    <p>Please wait...</p>
}

@if (Role?.ToLower() != Constants.RolePresenter)
{
    <hr />

    <div id="instructions">

        <h2>Links to send</h2>

        <h3>For the presenters</h3>

        <p>Send this link to the presenters. It will show the answers ratio as the votes come in, but it doesn't not show the polls controls.</p>

        <p><a href="/polls/@Handler.CurrentSession.SessionId/@Constants.RolePresenter" target="_blank">
                Open the Polls window (for the presenters)</a></p>

        <h3>For the viewers</h3>

        <p>Send this link in the chats, for all the viewers to vote on the polls.</p>

        <p><a href="/display-polls/@Handler.CurrentSession.SessionId" target="_blank">
                Open the Display Polls window (for the viewers)</a></p>

    </div>
}

