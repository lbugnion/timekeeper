@page "/host"
@page "/host/{ResetSession}"
@inject HttpClient Http
@inject ILogger<Host> Log
@inject IConfiguration Config
@inject ILocalStorageService LocalStorage
@inject IJSRuntime JSRuntime

<header>
    <img src="images/logo.png"
         class="logo-image" />

    @if (Branding.MustAuthorize)
    {
        <AuthorizeView>
            <Authorized>
                <div class="connected-guests">
                    @Handler.ConnectedGuests.Count guest(s)
                </div>
            </Authorized>
        </AuthorizeView>
    }
    else
    {
        <div class="connected-guests">
            @Handler.ConnectedGuests.Count guest(s)
        </div>
    }

</header>

<main>
    @if (Branding.MustAuthorize)
    {
        <AuthorizeView>
            <Authorized>
                <div class="start-all-clocks-area">
                    <button @onclick="(e => Handler.StartAllClocks(true))">
                        Start all clocks
                    </button>
                </div>
            </Authorized>
        </AuthorizeView>
    }
    else
    {
        <div class="start-all-clocks-area">
            <button @onclick="(e => Handler.StartAllClocks(true))">
                Start all clocks
            </button>
        </div>
    }

    <article>
        @if (Branding.CanEditSessionAndGuestName)
        {
            @if (IsEditingSessionName)
            {
                <input class="h1-edit-field" @bind-value="@SessionName" />
            }
            else
            {
                <h1>@SessionName</h1>
            }

            @if (!Handler.IsBusy)
            {
                <div class="edit-link"><a href="#" @onclick="EditSessionName" @onclick:preventDefault>(@EditSessionNameLinkText)</a></div>
            }
        }
        else
        {
            <h1>@Branding.HostPageTitle</h1>
        }


        @if (Program.IsExperimental)
        {
            <blockquote class="warning"><strong>WARNING:</strong> This is an experimental version of Timekeeper currently in development. This can be unstable and cause issues. Use only for test purposes.</blockquote>
        }

        @if (Branding.MustAuthorize)
        {
            <AuthorizeView>
                <NotAuthorized>
                    <blockquote class="warning">
                        Please <a href="/login">log in to use this page</a>.
                    </blockquote>
                </NotAuthorized>
                <Authorized>
                    <HostView Handler="@Handler" />
                </Authorized>
            </AuthorizeView>
        }
        else
        {
            <HostView Handler="@Handler" />
        }

    </article>
</main>

<footer>
    @if (Branding.MustAuthorize)
    {
        <AuthorizeView>
            <Authorized>
                <div class="status-message"><span class="error-message">@Handler.ErrorStatus</span><span>@Handler.Status</span></div>
            </Authorized>
            <NotAuthorized>
                <div class="status-message error-message">Please log in</div>
            </NotAuthorized>
        </AuthorizeView>
    }
    else
    {
        <div class="status-message"><span class="error-message">@Handler.ErrorStatus</span><span>@Handler.Status</span></div>
    }

    <div class="status-message about-link">| <a href="/about">About Timekeeper</a></div>
</footer>


